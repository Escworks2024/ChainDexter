<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Token Inflow Analyzer</title>
</head>
<body>
  <h1>Token Inflow Analyzer</h1>
  <p>Inserisci l'indirizzo del token e clicca "Analizza".</p>
  <input type="text" id="tokenAddress" placeholder="Token Address" />
  <button onclick="getTokenInflow()">Analizza</button>
  <pre id="output"></pre>

  <!-- Importa ethers.js -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.6.2/ethers.umd.min.js"></script>
  <script>
    const provider = new ethers.JsonRpcProvider("26f37d1491f84a288a2f917ce277e3dc");

    async function getTokenInflow() {
      const tokenAddress = document.getElementById("0x8c7ac134ed985367eadc6f727d79e8295e11435c").value;
      const output = document.getElementById("output");

      if (!ethers.isAddress(tokenAddress)) {
        output.textContent = "Errore: Indirizzo non valido.";
        return;
      }

      const oneWeekAgo = Math.floor(Date.now() / 1000) - 7 * 24 * 60 * 60;

      try {
        const logs = await provider.getLogs({
          address: tokenAddress,
          fromBlock: "earliest",
          toBlock: "latest"
        });

        let inflow = 0;
        let transactions = 0;

        for (let log of logs) {
          const block = await provider.getBlock(log.blockNumber);

          if (block.timestamp >= oneWeekAgo) {
            const tx = await provider.getTransaction(log.transactionHash);

            if (tx.to === tokenAddress) {
              inflow += parseFloat(ethers.formatUnits(tx.value, 18));
              transactions++;
            }
          }
        }

        output.textContent = `Totale inflow: ${inflow} tokens\nTransazioni: ${transactions}`;
      } catch (error) {
        output.textContent = `Errore: ${error.message}`;
      }
    }
  </script>
</body>
</html>

